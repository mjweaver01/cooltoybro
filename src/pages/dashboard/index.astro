---
import { siteName } from '@/lib/constants'
import Layout from '@/layouts/Layout.astro'
import User from '@/components/User.svelte'
import Navbar from '@/components/Navbar.svelte'
import Products from '@/components/Products.svelte'
import getUserData from '@/firebase/utils/auth/getUserData'
import getProducts from '@/firebase/utils/db/getProductData'

/* Check current session */
const sessionCookie = Astro.cookies.get('session')?.value ?? null

const user = await getUserData(sessionCookie)
const products = getProducts(sessionCookie)

if (!user) {
  return Astro.redirect('/signin')
}

const title = `Dashboard - ${siteName}`
const description = 'Dashboard page to view and manage firebase data'
---

<Layout {description} {title}>
  <Navbar {user} client:load />
  <User {user} client:load />
  <pre>{JSON.stringify(products)}</pre>
  <!-- <Products {products} client:load /> -->
</Layout>
